<form x-data="{ username: '', email: '', password: '', error: '', success: false, loading: false }"
      @submit.prevent="
        error = '';
        loading = true;
        fetch('/api/auth/register', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({email: email, password: password, username: username})
        }).then(r => {
            loading = false;
            if(r.ok) {
                success = true;
            } else r.json().then(d => { error = d.detail || 'Registration failed'; });
        }).catch(() => { loading = false; error = 'Something went wrong.'; })
      "
      class="space-y-3">
    <template x-if="!success">
        <div class="space-y-3">
            <div>
                <label class="block text-xs font-medium text-gray-700 mb-1">Username</label>
                <input type="text" x-model="username" required
                    class="w-full rounded border-gray-300 text-gray-900 text-sm p-2 border focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div>
                <label class="block text-xs font-medium text-gray-700 mb-1">Email</label>
                <p class="text-xs text-gray-400 mb-1">Your email will not be displayed publicly.</p>
                <input type="email" x-model="email" required
                    class="w-full rounded border-gray-300 text-gray-900 text-sm p-2 border focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div>
                <label class="block text-xs font-medium text-gray-700 mb-1">Password</label>
                <input type="password" x-model="password" required minlength="8"
                    class="w-full rounded border-gray-300 text-gray-900 text-sm p-2 border focus:ring-blue-500 focus:border-blue-500">
            </div>
            <p x-show="error" class="text-red-600 text-xs" x-text="error"></p>
            <button type="submit" :disabled="loading"
                class="w-full px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition-colors disabled:opacity-50">
                <span x-show="!loading">Sign up</span>
                <span x-show="loading">Creating account...</span>
            </button>
        </div>
    </template>
    <template x-if="success">
        <div class="text-center py-4">
            <svg class="w-12 h-12 text-green-500 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
            </svg>
            <p class="text-gray-900 font-semibold text-sm">Check your email</p>
            <p class="text-gray-500 text-xs mt-1">We sent a verification link to your email address. Click it to activate your account.</p>
        </div>
    </template>
</form>

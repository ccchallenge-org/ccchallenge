{% extends "_layout.html" %}

{% block title %}ccchallenge{% endblock %}

{% block content %}
<div>
    <!-- Header Section -->
    <div class="text-left mb-8 px-2 font-mono">
        <h1 class="underline">Challenge goal</h1>
        <p class="text-blue-100 max-w-4xl mb-6">
            Formalised results: {{ papers|selectattr('formalisations_count', 'gt', 0)|list|length }} /
            {{ papers|length }}.
        </p>
    </div>

    <!-- Papers Grid -->
    <div class="grid grid-cols-1 gap-4 max-w-3xl mx-auto">
        {% for paper in papers %}
        <div id="{{ paper.id }}"
            class="bg-white rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300 p-4 pb-2">
            <!-- Paper Type Badge -->
            <div class="flex justify-between items-start mb-3">
                <span
                    class="inline-block bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded uppercase">
                    {{ paper.type }}
                </span>
                <span class="text-sm font-semibold text-gray-900">{{ paper.year }}</span>
            </div>

            <!-- Title -->
            <h3 class="text-lg font-semibold text-gray-900 leading-tight math-content">
                {{ paper.title }}
            </h3>

            <!-- Authors -->
            <p class="text-sm text-gray-600">
                <span class="font-medium">Authors:</span> {{ paper.authors }}
            </p>

            <!-- Venue Information -->
            {% if paper.venue %}
            <p class="text-xs text-gray-600 mb-4 max-w-xl truncate">
                <span class="font-medium" title="{{ paper.venue }}">{{ paper.venue }}
            </p>
            {% endif %}

            <!-- Abstract Preview -->
            <!-- {% if paper.abstract %}
            <p class="text-sm text-gray-700 mb-4 line-clamp-3">
                {{ paper.abstract[:150] }}{% if paper.abstract|length > 150 %}...{% endif %}
            </p>
            {% endif %} -->

            <!-- Links -->
            <div class="flex flex-wrap gap-2 mt-auto justify-between items-center">
                <!-- Left-hand side buttons (discrete) -->
                <div class="flex flex-wrap gap-2">
                    {% if paper.doi %}
                    <a href="{{ paper.doi if paper.doi.startswith('http') else 'https://doi.org/' + paper.doi }}"
                        target="_blank"
                        class="inline-flex items-center px-3 py-1 bg-blue-50 hover:bg-blue-100 text-blue-600 text-xs font-medium rounded transition-colors border border-blue-200">
                        ðŸ“„ DOI
                    </a>
                    {% else %}
                    <span
                        class="inline-flex items-center px-3 py-1 bg-blue-25  text-gray-400 text-xs font-medium rounded border border-blue-100">
                        ðŸ“„ DOI
                    </span>
                    {% endif %}

                    {% if paper.url %}
                    <a href="{{ paper.url }}" target="_blank"
                        class="inline-flex items-center px-3 py-1 bg-blue-50 hover:bg-blue-100 text-blue-600 text-xs font-medium rounded transition-colors border border-blue-200">
                        ðŸ”— URL
                    </a>
                    {% else %}
                    <span
                        class="inline-flex items-center px-3 py-1 bg-blue-25 text-gray-400 text-xs font-medium rounded border border-blue-100">
                        ðŸ”— URL
                    </span>
                    {% endif %}

                    <button
                        class="download-bibtex inline-flex items-center px-3 py-1 bg-blue-50 hover:bg-blue-100 text-blue-600 text-xs font-medium rounded transition-colors border border-blue-200"
                        data-id="{{ paper.id }}" data-bibtex="{{ paper.raw_bibtex|e }}">
                        ðŸ“‹ BibTeX
                    </button>
                </div>

                <!-- Right-hand side button (important) -->
                <div class="flex items-center">
                    <button
                        class="inline-flex items-center px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm font-semibold rounded-lg transition-colors shadow-sm">
                        {{ paper.formalisations_count }} Formal Proofs
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- No Papers Message -->
    {% if not papers %}
    <div class="text-center py-12">
        <div class="text-gray-400 text-6xl mb-4">ðŸ“š</div>
        <h3 class="text-xl font-medium text-white mb-2">No Papers Found</h3>
        <p class="text-blue-100">The Collatz_conjecture.bib file couldn't be loaded or is empty.</p>
    </div>
    {% endif %}
</div>

<!-- Custom CSS for line clamping -->
<style>
    .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>

<script>
    // Handle BibTeX download buttons
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.download-bibtex').forEach(button => {
            button.addEventListener('click', function () {
                const paperId = this.dataset.id;
                const bibtexContent = this.dataset.bibtex;

                // Create a downloadable file
                const blob = new Blob([bibtexContent], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);

                // Create a temporary link and click it
                const link = document.createElement('a');
                link.href = url;
                link.download = `${paperId}.bib`;
                document.body.appendChild(link);
                link.click();

                // Clean up
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);
            });
        });
    });
</script>
{% endblock %}